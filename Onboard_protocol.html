<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <title>Протокол борт-земля</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <!-- decode file CSS -->
    <style type="text/css">
        .ln { color: rgb(0,0,0); font-weight: normal; font-style: normal; }
        .s0 { color: rgb(204,120,50); font-weight: bold; }
        .s1 { color: rgb(169,183,198); }
        .s2 { color: rgb(106,135,89); }
        .s3 { color: rgb(204,120,50); }
        .s4 { color: rgb(104,151,187); }
        .s5 { color: rgb(128,128,128); }
    </style>

    <style type="text/css">
        body {
            counter-reset: h2counter;
            counter-reset: h3counter;
            counter-reset: h4counter;
            counter-reset: h5counter;
            counter-reset: h6counter;
        }
        h1 {
            counter-reset: h2counter;
        }
        h2 {
            counter-reset: h3counter;
        }
        h3 {
            counter-reset: h4counter;
        }
        h4 {
            counter-reset: h5counter;
        }
        h5 {
            counter-reset: h6counter;
        }
        h2:before {
            content: counter(h2counter) " ";
            counter-increment: h2counter;
            counter-reset: h3counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
        h3:before {
            content: counter(h2counter) "." counter(h3counter) " ";
            counter-increment: h3counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
        h4:before {
            content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) " ";
            counter-increment: h4counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
        h5:before {
            content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) "." counter(h5counter) " ";
            counter-increment: h5counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
        h6:before {
            content: counter(h2counter) "." counter(h3counter) "." counter(h4counter) "." counter(h5counter) "." counter(h6counter) " ";
            counter-increment: h6counter;
            font-size: 65%;
            font-weight:400;
            line-height:1;
            color:#777
        }
    </style>
</head>
<body>

<div class="container">

    <h1>Протокол борт-земля</h1>

    <h2 id="about">Назначение протокола</h2>
    <div>
        <p>Протокол борт-земля предназначен для организации обмена и обеспечения управления беспилотными аппаратами, как наземными, так и
воздушными, водными, космическими и другими типами аппаратов как с постоянной, так и сеансовой связью.
        <p>Протокол позволяет организовать информационный обмен между одним или несколькими распределенными наземными или мобильными пунктами управления и отдельным аппаратом или распределенной группой разнородных аппаратов, а так же между пунктами управления, отдельными аппаратами и группами аппаратов.
        <p>Использование протокола позволяет избежать множества ошибок допускаемых при проектировании и переиспользовать накопленный опыт проектирования протоколов в различных направлениях. Кроме того, протокол в своем составе предлагает полный набор инструментов для создания наземных и бортовых систем управления, отладки и тестирования обменов, организации бортовой системы исполнения кода и средства для его написания и отладки. А так же комплекс средств по хранению и анализу телеметрической информации и обеспечению научных расчетов.
        <p>Кроме того, при разработке протокола были учтены требования к обеспечению возможности эволюционного изменения и дополнения на основе будущих требований от перспективных авиа-космических и наземных комплексов, а так же обесечения обратной совместимости и возможностей управления аппаратами с разными версиями и набором доступной функциональности.
    </div>
    <hr/>

    <h2 id="streams">Информационный обмен</h2>
    <div>
        <h3 id="streams-types">Описание типов данных</h3>
        <div>
            <p>Все поля заголовков пакетов кодируются в формате длины <a href="https://en.wikipedia.org/wiki/X.690#BER_encoding">формата BER</a> (если явно не указано иное) который позволяет кодировать значение от 0 до 2<sup>128</sup>. Старший бит первого байта кодирует вид формата: если он равен 0, то оставшиеся 7 бит кодируют непосредственно значение, если он равен 1, то
оставшиеся 7 бит кодируют длину значения в байтах + 1, а затем идет непосредственно само значение. Корректным представлением значения является самое компактное представление где старший бит первого байта сброшен, например 0 должен быть представлен как 0b0000 0000.
        </div>
        <hr/>

        <h3 id="streams-stack">Стек обменных протоколов</h3>
        <div>
            <p>С целью упрощения реализации и внесения изменений в структуру информационного обмена протокол информационного обмена представляет собой иерархическую структуру &mdash; стек протоколов, где каждый уровень имеет выделенный смысл и возложенные на него функции, а так же полностью регламентирует структуру пакетов и место в иерархии. Каждый нижележащий уровень стека может включать только пакеты ближайшего к нему верхнего уровня стека.
            <table class="table" style="width:auto">
                <thead>
                    <tr><th>Название уровня стека протоколов
                        <th>Назначение уровня
                </thead>
                <tbody>
                    <tr><td><a href="#streams-app">Прикладной уровень</a>
                        <td>Используется для передачи команд, ответов на команды и телеметрической информации.
                    <tr><td><a href="#streams-exchange">Обменный уровень</a>
                        <td>Используется для адресации устройств и компонентов устройства в обменной сети.
                    <tr><td><a href="#streams-multiplexing">Мультиплексирование обменных потоков</a>
                        <td>Опциональный уровень, может быть опущен при использовании разных каналов связи для потоков. Используется для мультиплексирования (смешивания) данных разных потоков, а так же позволяет производить гарантированную доставку пакетов.
                    <tr><td><a href="#streams-crypt-multiplex">Шифрование мультиплексированного канального потока</a>
                        <td>Опциональный уровень. Используется только для шифрования всех информационных обменных потоков данных.
                </tbody>
            </table>
            <p>Информационный обмен спроектирован таким образом, что позволяет реализовать библиотеку для разбора информационных потоков без необходимости внесения изменений в неё даже в случае эволюционного изменения протокола при условии соблюдения правил эволюции протокола.
        </div>
        <hr/>

        <h3 id="streams-crypt-multiplex">Шифрование на уровне мультиплексированного канального потока</h3>
        <div>
            <p>В случае шифрования всех информационных потоков канальный поток имеет вид:
                <table class="table table-bordered" style="width:auto">
                    <tbody>
                    <tr>
                        <td><a href="#streams-crypt-multiplex-packet">Пакет шифрования канального уровня
                        <td><a href="#streams-crypt-multiplex-packet">Пакет шифрования канального уровня
                        <td>...
                    </td></tr></tbody>
                </table>
            <hr/>

            <h4 id="streams-crypt-multiplex-packet">Пакет шифрования канального уровня</h4>
            <div>
                <p>Пакет шифрования должен иметь фиксированный размер <sup><span class="label label-warning">будет уточнено в следующих редакциях</span></sup> (например, 256 байт), при необходимости передачи открытых данных могут быть зашифрованы не все данные пакета, что определяется конкретной реализацией метода шифрования.
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Название
                            <th>Тип
                            <th>Значение
                            <th>Описание
                    </thead>
                    <tbody>
                        <tr><td rowspan="4">Заголовок пакета
                            <td rowspan="4">Uint8
                            <td>0x0C
                            <td rowspan="4">
                        <tr><td>0x82
                        <tr><td>0x4A
                        <tr><td>0xF2
                        <tr><td>Длина данных пакета
                            <td>
                            <td>
                            <td>
                        <tr><td>Данные пакета
                            <td>
                            <td>
                            <td>Состав данных описан в разделе <a href="#streams-multiplexing">Мультиплексирование потоков</a>.
                    </tbody>
                </table>
                <p>Для поиска начала пакета в потоке используется фиксированный заголовок пакета. В случае использования известной длины пакета она так же может быть использована для быстрого поиска корректных пакетов.
                <p>Пакет считается корректным, если полностью совпадает заголовок и считаны данные пакета.
            </div>
        </div>
        <hr/>

        <h3 id="streams-multiplexing">Мультиплексирование потоков</h3>
        <div>
            <p>Общий вид потоков данных борт-земля и земля-борт совпадают. В общем информационном обмене участвуют 2 потока данных:
                <ul>
                    <li>поток с подтверждением доставки, используется для доставки командных сообщений и результаты исполнения команд;
                    <li>поток без подтверждения доставки, используется для передачи телеметрической информации.
                </ul>
            <p>При наличии технической возможности и необходимости потоки могут быть разнесены по отдельным радиоканалам или радиосредствам, в частности, при наличии медленного, но надежного канала и быстрого, но ненадежного, потоки с управляющей информацией могут использовать более надежные каналы связи.
            <p>При использовании одного канала для передачи потока с подтверждением и без подтверждения доставки призводится мультиплексирование потоков по определенным стандартом правилам.
            <p>Кроме того, поддерживается механизм шифрования как на уровне канального мультплексированного потока (шифрование всех передаваемых потоков на одном уровне), так и на уровне отдельного канала <sup><span class="label label-warning">будет уточнено в следующих редакциях</span></sup>.
            <p>При использовании мультиплексирования поток включает пакеты от каждого из обменных потоков с разделителем между ними.
                <table class="table table-bordered" style="width:auto">
                    <tbody>
                        <tr>
                            <td><a href="#streams-multiplexing-delimiter-packet">Разделитель мультиплексных потоков
                            <td><a href="#streams-multiplexing-data-packet">Пакет обменного потока данных</a> | <a href="#streams-multiplexing-counter-packet">Пакет согласования счетчика</a> | <a href="#streams-multiplexing-confirmation">Пакет подтверждения получения</a>
                            <td><a href="#streams-multiplexing-delimiter-packet">Разделитель мультиплексных потоков
                            <td><a href="#streams-multiplexing-data-packet">Пакет обменного потока данных</a> | <a href="#streams-multiplexing-counter-packet">Пакет согласования счетчика</a> | <a href="#streams-multiplexing-confirmation">Пакет подтверждения получения</a>
                            <td>...
                    </tbody>
                </table>
            <p>Разбор мультиплексированного потока производится по <a href="#streams-delimiter-parsing">правилам разбора потоков с разделителем</a>. Пакет запроса повтороной передачи используется только для управления потоком обеспечивающим гарантированную передачу (командный и обратный командному потоки). Пакет согласования счетчика пакетов используется в специальных случаях, например, с НКУ на борт в случае рассогласования обмена по командным потокам, все эти случаи и последовательность действий в таких случаях, а так же участие в них оператора должны быть явно регламентированы <sup><span class="label label-warning">будет уточнено в следующих редакциях</span></sup>.
            <hr/>

            <h4 id="streams-multiplexing-delimiter-packet">Разделитель мультиплексных потоков</h4>
            <div>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Название
                            <th>Тип
                            <th>Значение
                    </thead>
                    <tbody>
                        <tr><td rowspan="2">Значение разделителя
                            <td rowspan="2">Uint8
                            <td>0x04
                        <tr><td>0x7E
                    </tbody>
                </table>
                <p>Пакет считается корректным если он полностью совпадает с требуемым.
            </div>
            <hr/>

            <h4 id="streams-multiplexing-data-packet">Пакет обменного потока данных</h4>
            <div>
                <p>Пакет обменного потока данных предназначен непосредственно для передачи данных обменного уровня. Он использует возможности активного обменного окна, что позволяет гарантировать получение пакета адресатом. До получения подтверждения доставки пакета в случае потока с гарантией на доставку отправитель обязан обеспечить хранение уже отправленных пакетов в рамках установленного активного окна обмена.
                <p>Для достижения максимальной скорости обмена и заполнения канала полезной информацией получатель должен обеспечить возможность получения и хранения количества пакетов равного как минимум размеру активного окна обмена.
                    <table class="table table-bordered">
                        <thead>
                            <tr><th>Название
                                <th>Тип
                                    <th>Значение
                        </thead>
                        <tbody>
                            <tr><td rowspan="2">Заголовок пакета
                                <td rowspan="2">Uint8
                                <td>0x6С
                            <tr><td>0x5A
                            <tr><td>Длина данных пакета
                                <td>
                                <td>Считается начиная с поля "Размер активного окна обмена" и включает в том числе "Значение контрольной суммы"
                            <tr><td>Служебное
                                <td>
                                <td>1
                            <tr><td>Номер потока данных
                                <td>
                                <td>
                                    <ul>
                                        <li>1 &mdash; Поток команд или ответов на команды с гарантированной доставкой;
                                        <li>2 &mdash; Поток ТМ-ифнормации без гарантий на доставку.
                                    </ul>
                            <tr><td colspan="3"><a href="#streams-checksum">Блок защиты целостности данных пакета</a>
                            <tr><td>Размер активного окна обмена
                                <td>
                                <td>Не должен превышать половину от максимального значения счетчика пакета
                            <tr><td>Счетчик пакета
                                <td>
                                <td>0&ndash;65535
                            <tr><td>Данные пакета
                                <td>
                                <td>Формат данных пакета описан в разделе <a href="#streams-exchange">Обменные потоки данных</a>
                            <tr><td>Значение контрольной суммы
                                <td>Определяется видом защиты целостности информации
                                <td>
                        </tbody>
                    </table>
                <p>Пакет считается корректным при совпадении заголовка, длины пакета, номера потока, а так же при корректности контрольной суммы. Так же проверяется счетчик пакета &mdash; он должен быть на единицу больше предыдущего значения пакета (в случае последнего пакета со значением счетчика 65535 единственным допустимым значением является 0). В случае потока без гарантии на доставку пакета счетчик пакета не контролируется. В случае получения пакета согласования счетчика &mdash; его значение не сверяется с существующим, вместо этого текущее значение ожидаемого счетчика устанавливается в новое значение.
            </div>
            <hr/>

            <h4 id="streams-multiplexing-counter-packet">Пакет согласования счетчика</h4>
            <div>
                <p>Пакет согласования счетчика пакетов предназначен для установки счетчика пакетов приемника в необходимое значение с целью восстановления обмена при потере пакета и невозможности его восстановления и пересылки.
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th>Название
                                <th>Тип
                                <th>Значение
                                <th>Описание
                        </thead>
                        <tbody>
                            <tr><td rowspan="2">Заголовок пакета
                                <td rowspan="2">Uint8
                                <td>0x64
                                <td rowspan="2">Заголовок определяющий пакет согласования счетчика пакетов
                            <tr><td>0x5B
                            <tr><td>Служебное
                                <td>
                                <td>1
                                <td>
                            <tr><td>Номер потока
                                <td>
                                <td>1 &mdash; Поток команд или ответов на команды с гарантированной доставкой<br>2 &mdash; Поток ТМ-информации без гарантий на доставку
                                <td>Номер потока данных
                            <tr><td colspan="3"><a href="#streams-checksum">Блок защиты целостности данных пакета</a>
                            <tr><td>Счетчик пакета
                                <td>
                                <td>0&ndash;65535
                                <td>Новое значение для счетчика пакетов приемника
                            <tr><td>Значение контрольной суммы
                                <td>Определяется видом защиты целостности информации
                                <td>
                        </tbody>
                    </table>
            </div>
            <hr/>

            <h4 id="streams-multiplexing-confirmation">Пакет подтверждения получения</h4>
            <div>
                <p>Пакет служит для подтверждения получения пакетов данных, он должен быть сформирован в случае получения пакета с номером пакета превышающим следующий необходимый, либо при невозможности разбора полученного пакета. Кроме того, пакет подтверждения получения формируется для сдвига активного обменного окна. В случае получения такого пакета отправителем пакетов данных он может сдвинуть окно на соответствующий номер пакета и продолжить пересылку новых пакетов данных. Если полученный номер пакета меньше текущего отправляемого, то отправитель пакетов даннах обязан произвести повторную передачу указанного пакета, а после этого уже вернуться к отправлению следующих пакетов с того номера, на котором он был прерван.
                <p>Для обеспечения заполнения канала информацией и достижения максимальной скорости обмена, участники обмена должны использовать подходящий размер активного окна обмена и получатель пакетов данных должен заблаговременно сдвигать активное окно до достижения предела отправителем.
                <p>Пакет используется для управления потоками с обеспечением гарантированной доставки.
                    <table class="table table-bordered">
                        <thead>
                            <tr><th>Название
                                <th>Тип
                                <th>Значение
                        </thead>
                        <tbody>
                            <tr><td rowspan="2">Заголовок пакета
                                <td rowspan="2">Uint8
                                <td>0x34
                            <tr><td>0x5C
                            <tr><td>Служебное
                                <td>
                                <td>1
                            <tr><td>Номер потока данных
                                <td>
                                <td>1 &mdash; Поток команд или ответов на команды с гарантированной доставкой
                            <tr><td colspan="4"><a href="#streams-checksum">Блок защиты целостности данных пакета</a>
                            <tr><td>Номер последнего корректного пакета
                                <td>
                                <td>
                            <tr><td>Значение контрольной суммы
                                <td>Определяется видом защиты целостности информации
                                <td>
                        </tbody>
                    </table>
                <p>Пакет считается корректным при совпадении заголовка, длины пакета, номера потока, а так же при корректности контрольной суммы.
            </div>
        </div>
        <hr/>

        <h3 id="streams-exchange">Обменные потоки данных</h3>
        <div>
            <p>Обменный поток данных состоит из адресных пакетов обменного потока данных:
                <table class="table table-bordered" style="width:auto">
                    <tbody>
                        <tr>
                            <td><a href="#streams-exchange-packet">Адресный пакет обменного потока данных
                            <td><a href="#streams-exchange-packet">Адресный пакет обменного потока данных
                            <td>...
                    </tbody>
                </table>
            <hr/>

            <h4 id="streams-exchange-packet">Адресный пакет обменного потока данных</h4>
            <div>
                <p>Пакет обменного потока данных обеспечивает адресацию наземных и бортовых устройств и компонентов, пакет маркируется временем формирования.
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Название
                            <th>Тип
                            <th>Значение
                            <th>Описание
                    </thead>
                    <tbody>
                        <tr><td rowspan="2">Заголовок пакета
                            <td rowspan="2">Uint8
                            <td>0xAC
                        <tr><td>0x5E
                        <tr><td>Длина данных пакета<td><td><td>
                        <tr><td>Вид адресации
                            <td>
                            <td>
                            <td>
                                <ul>
                                    <li>3 &mdash; Широковещательное сообщение без указания адреса приемника: источник + компонент / компонент приемника
                                    <li>4 &mdash; Адресация в сети: источник + компонент / приемник + компонент
                                    <li>6 &mdash; Групповая адресация: группа источника + источник в группе + компонент / группа приемника + приемник в
                                        группе + компонент
                                </ul>
                        <tr><td>Адрес источника
                            <td>
                            <td>
                            <td>
                        <tr><td>Номер компонента источника
                            <td>
                            <td>
                            <td>
                        <tr><td>Номер компонента приемника
                            <td>
                            <td>
                            <td>
                        <tr><td>Адрес приемника
                            <td>
                            <td>
                            <td>Формируется только в случае адресации 4 и 6
                        <tr><td>Группа источника
                            <td>
                            <td>
                            <td>Формируется только в случае вида адресации 6
                        <tr><td>Группа приемника
                            <td>
                            <td>
                            <td>Формируется только в случае вида адресации 6
                        <tr><td>Вид метки времени
                            <td>
                            <td>2 &mdash; Unix timestamp + 1/256 доли секунды
                            <td>
                        <tr><td>Метка времени формирования пакета
                            <td>
                            <td>
                            <td>UNIX timestamp * 256 + 1/256 доли секунды
                        <tr><td>Данные пакета
                            <td>
                            <td>
                            <td>Формат данных потока описан в разделе <a href="#streams-app">Поток данных прикладного уровня</a>
                    </tbody>
                </table>
            </div>
        </div>
        <hr/>

        <h3 id="streams-app">Поток данных прикладного уровня</h3>
        <div>
            <p>Поток данных прикладного уровня зависит от направления передачи данных (борт-земля, земля-борт), а так же от типа потока (командный или телеметрический).
            <p>Командный поток земля-борт (или аппарат-источник—аппарат-приемник):
                <table class="table table-bordered" style="width:auto">
                    <tbody>
                        <tr>
                            <td><a href="#streams-app-control-command">Командное сообщение
                            <td><a href="#streams-app-control-command">Командное сообщение
                            <td>...
                    </tbody>
                </table>
            <p>Командный поток борт-земля (или аппарат-приемник—аппарат-источник):
                <table class="table table-bordered" style="width:auto">
                    <tbody>
                        <tr>
                            <td><a href="#streams-app-control-result">Результат исполнения команды
                            <td><a href="#streams-app-control-result">Результат исполнения команды
                            <td>...
                    </tbody>
                </table>
            <p>Телеметрический поток борт-земля:
                <table class="table table-bordered" style="width:auto">
                    <tbody>
                        <tr>
                            <td><a href="#streams-app-delimiter">Разделитель потока прикладного уровня
                            <td><a href="#streams-app-tm-event">Событийное ТМ-сообщение</a> | <a href="#streams-app-tm-status">Статусное ТМ-сообщение</a>
                            <td><a href="#streams-app-delimiter">Разделитель потока прикладного уровня
                            <td><a href="#streams-app-tm-event">Событийное ТМ-сообщение</a> | <a href="#streams-app-tm-status">Статусное ТМ-сообщение</a>
                            <td>...
                    </tbody>
                </table>
            <p>Телеметрический поток земля-борт в данной редакции протокола не используется.
            <hr/>

            <h4 id="streams-app-delimiter">Разделитель потока прикладного уровня</h4>
            <div>
                <p>Разделяет между собой пакеты прикладного уровня.
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Название
                            <th>Тип
                            <th>Значение
                    </thead>
                    <tbody>
                        <tr><td rowspan="2">Значение разделителя
                            <td rowspan="2">Uint8
                            <td>0x04
                        <tr><td>0x3D
                    </tbody>
                </table>
                <p>Пакет считается корректным если он полностью совпадает с требуемым.
            </div>
            <hr/>

            <h4 id="streams-app-tm">Данные обменных пакетов ТМ-информации</h4>
            <div>
                <p>ТМ-информация состоит из пакетов ТМ-сообщений. ТМ-сообщение может быть одного из двух типов:
                    <ul>
                        <li>Событийное ТМ-сообщение предназначено для уведомления наземного комплекса управления (НКУ) о наступлении определенного события на борту, например о возникновении ошибки, смене режимов, выхода параметров за допустимые пределы, получении и исполнении команды и т.п. Событийные сообщения привязываются к точному бортовому времени возникновения события.
                        <li>Статусное ТМ-сообщение предназначено для передачи информации о внутреннем состоянии бортового комплекса и может формироваться как циклически, так и в соответствии с внутренней логикой работы компонентов.
                    </ul>
                <p>ТМ-сообщение включает значения бортовых параметров в данных ТМ-сообщения. Перечень и тип передаваемых параметров определяается на основе базы данных бортовых параметров по номеру компонента и номеру ТМ-сообщения.
                <hr/>

                <h5 id="streams-app-tm-event">Событийное ТМ-сообщение</h5>
                <div>
                    <p>Пакет содержит данные событийного ТМ-сообщения.
                    <table class="table table-bordered">
                        <thead>
                            <tr><th>Название
                                <th>Значение
                                <th>Описание
                        </thead>
                        <tbody>
                            <tr><td rowspan="2">Заголовок событийного ТМ-сообщения
                                <td>0x0С
                                <td rowspan="2">
                            <tr><td>0x78
                            <tr><td>Длина данных
                                <td>
                                <td>Длина данных ТМ-сообщения
                            <tr><td>Номер бортового компонента
                                <td>
                                <td>Определяет номер компонента к которому относится ТМ-сообщение
                            <tr><td>Номер ТМ-сообщения
                                <td>
                                <td>Определяет номер ТМ-сообщения в рамках компонента
                            <tr><td>Номер события
                                <td>
                                <td>Определяет номер события из ТМ-сообщения
                            <tr><td>Метка времени
                                <td>
                                <td>UNIX timestamp * 256 + 1/256 доли секунды
                            <tr><td>Данные параметров ТМ-сообщения
                                <td>
                                <td>Параметры ТМ-сообщения
                        </tbody>
                    </table>
                </div>
                <hr>

                <h5 id="streams-app-tm-status">Статусное ТМ-сообщение</h5>
                <div>
                    <p>Пакет содержит данные статусного ТМ-сообщения.
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Название
                                    <th>Значение
                                    <th>Описание
                            </thead>
                            <tbody>
                                <tr><td rowspan="2">Заголовок статусного ТМ-сообщения
                                    <td>0x1С
                                    <td rowspan="2">
                                <tr><td>0x72
                                <tr><td>Длина данных
                                    <td>
                                    <td>Длина данных ТМ-сообщения
                                <tr><td>Номер сегмента
                                    <td>
                                    <td>В случае несегментированного пакета должен быть установлен в 0.
                                <tr><td>Максимальный номер сегмента
                                    <td>
                                    <td>В случае несегментированного пакета должен быть установлен в 0.
                                <tr><td>Номер бортового компонента
                                    <td>
                                    <td>Определяет номер компонента к которому относится ТМ-сообщение
                                <tr><td>Номер ТМ-сообщения
                                    <td>
                                    <td>Определяет номер ТМ-сообщения в рамках компонента
                                <tr><td>Данные параметров ТМ-сообщения
                                    <td>
                                    <td>Параметры ТМ-сообщения
                            </tbody>
                        </table>
                </div>
            </div>
            <hr>

            <h4 id="streams-app-control">Данные обменных пакетов управляющей информации</h4>
            <div>
                <h5 id="streams-app-control-command">Командное сообщение</h5>
                <div>
                    <p>Пакет служит для передачи командного сообщения.
                        <table class="table table-bordered">
                            <thead>
                                <tr><th>Название
                                    <th>Значение
                                    <th>Описание
                            </thead>
                            <tbody>
                                <tr><td rowspan="2">Заголовок командного сообщения
                                    <td>0x0С
                                    <td rowspan="2">
                                <tr><td>0x65
                                <tr><td>Длина данных
                                    <td>
                                    <td>Длина данных сообщения
                                <tr><td colspan="3">Данные сообщения
                                <tr><td>Команда 1
                                    <td rowspan="4">
                                    <td rowspan="4">
                                        <p>Команда кодируется в следующем виде:
                                            <table class="table table-bordered">
                                                <tbody>
                                                    <tr>
                                                        <td>Номер бортового компонента
                                                        <td>Определяет номер компонента к которому относится сообщение
                                                    <tr>
                                                        <td>Номер команды
                                                        <td>Определяет номер команды в рамках компонента
                                                    <tr>
                                                        <td>Данные параметров команды
                                                        <td>Параметры команды
                                                </tbody>
                                            </table>
                                <tr><td>Команда 2
                                <tr><td>...
                                <tr><td>Команда N
                            </tbody>
                        </table>
                </div>

                <h5 id="streams-app-control-result">Результат исполнения команды</h5>
                <div>
                    <p>Пакет содержит данные результата исполнения команды.
                        <table class="table table-bordered">
                            <thead>
                                <tr><th>Название
                                    <th>Значение
                                    <th>Описание
                            </thead>
                            <tbody>
                                <tr><td rowspan="2">Заголовок пакета результата исполнения команды
                                    <td>0x0С
                                    <td rowspan="2">
                                <tr><td>0x66
                                <tr><td>Длина данных
                                    <td>
                                    <td>Длина данных сообщения
                                <tr><td>Результат исполнения команды (данные сообщения)
                                    <td>
                                    <td>
                            </tbody>
                        </table>
                </div>
            </div>
        </div>
        <hr>

        <h3 id="streams-delimiter-parsing">Алгоритм разбора потока с разделителем</h3>
        <div>
            <p>Последовательность разбора потока с разделителем следующая:
            <ol type="A">
                <li>найти в потоке разделитель;
                <li>попытаться прочесть пакет следующий сразу за разделителем:
                    <ol type="1">
                        <li>если пакет считан успешно, то попытаться прочесть разделитель следующий сразу за пакетом:
                            <ol type="a">
                                <li>если разделитель считан успешно, то продолжать разбор с пункта B;
                                <li>если разделитель не был считан успешно, то попытаться считать пакет данных со смещением в длину разделителя от конца предыдущего пакета (разделитель может быть испорчен при передаче):
                                    <ol type="i">
                                        <li>если пакет считан успешно, то продолжить с пункта 1;
                                        <li>если пакет не был считан, то начать с самого начала (пункт A) в поисках нового разделителя.
                                    </ol>
                            </ol>
                        <li>если пакет не был считан, то продолжить с пункта A.
                    </ol>
            </ol>
        </div>
        <hr>

        <h3 id="streams-checksum">Блок защиты целостности данных пакета</h3>
        <div>
            <p>Блок защиты целостности данных имеет следущую структуру:
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>Название
                            <th>Значение
                    </thead>
                    <tbody>
                        <tr><td>Вид защиты целостности информации
                            <td><ul>
                                    <li>1 &mdash; Контрольная сумма CRC-16. Длина контрольной суммы 2 байта.
                                    <li>2 &mdash; Коды Рида-Соломона. Длина контрольной последовательности 64 байта.
                                </ul>
                    </tbody>
                </table>
            <p>В расчете контрольной суммы используются все данные пакета и его заголовка, кроме самого значения контрольной суммы, которое располагается в самом конце данных пакета.
        </div>
    </div>
    <hr/>

    <h2 id="arch">Архитектура бортовой системы</h2>
    <div>
        <h3 id="arch-comp">Компонентная архитектура бортовой программы</h3>
        <div>
            <p>Бортовая система описывается в виде иерархии системных или функциональных блоков ПО &mdash; компонентов. Каждый компонент представляет собой набор параметров, которые данным компонентом могут быть сформированы в составе сообщений телеметрической (ТМ) информации, самих ТМ-сообщений, которые могут быть выданы на наземный комплекс управления (НКУ) или в другой аппарат, а так же набором команд посредством вызова которых может быть осуществлено управления компонентом.
            <p>Компонент может так же включать в себя другие компоненты (подкомпоненты), выстраивая таким образом иерархию и позволяя переиспользование готовых блоков функциональности бортовых систем. Компонент включающий подкомпоненты  должен реализовывать исполнение команд этих подкомпонентов (и всех их подкомпонентов), формирование и выдачу их ТМ-сообщений, и, кроме того, может формировать ТМ-сообщения включающие как свои собственные ТМ-параметры, так и параметры подкомпонентов.
            <p>Каждому аппарату ставится в соответствие один компонент аппарата, который должен полностью описывать все возможные подкомпоненты, команды и ТМ-сообщения, которые аппаратом поддерживаются.
            <p>Для описания компонентов бортового ПО спроектирована предметная модель и язык <abbr title="от DEvice COmponents DEfinition">Decode</abbr>.
        </div>
        <hr/>

        <h3 id="arch-tm">Формирование и выдача телеметрической информации</h3>
        <div>
            <p>В архитектуре бортовой системы предусмотрен отдельный
компонент отвечающий за сбор, формирование и выдачу ТМ-информации с
борта на НКУ и на другие аппараты. Минимальной единицей выдаваемой
ТМ-информации является ТМ-сообщение состоящее из набора ТМ-параметров.
            <p>ТМ-информация делится на:
                <ul>
                    <li>статусную информацию, которая формируется из
актуальных значений параметров бортового комплекса на момент
формирования и в общем случае не привязана к наступлению определенных
событий в бортовой системе;
                    <li>событийную информацию, которая привязана к
наступлению определенных событий (например, возникновению ошибок) и
формируется непосредственно в момент наступления события.
                </ul>
            <p><a href="#decode">Полное описание команд и ТМ-сообщений компонента реализовано на языке Decode.</a>
            <hr/>

            <h4 id="arch-tm-status">Формирование статусной ТМ-информации</h4>
            <div>
                <p>Формирование статусной ТМ-информации производится компонентом формирования ТМ-информации циклически в соответствии с приоритетами. Каждый приоритет от 1 и далее указывает на то, что независимо от ширины канала связи формирование ТМ-сообщений с приоритетом N производится с частотой в 2 раза более высокой, чем сообщений с приоритетом N+1. Таким образом на каждое сообщение с приоритетом 3 будет выдано 2 сообщения с приоритетом 2 и 4 сообщения с приоритетом 1.
                <p>Очередность выдачи сообщений задается их порядком в таблице статусных ТМ-сообщений, которая формируется на основе всех статусных ТМ-сообщений всех входящих в бортовую систему компонентов. ТМ-компонент позволяет гибко управлять формированием статусной ТМ-информации, а именно: изменять приоритеты ТМ-сообщений в процессе работы, включать и выключать формирование отдельных ТМ-сообщений или всех сообщений определенного компонента.
                <p>Статусные сообщения могут быть сформированы и вне циклической выдачи непосредственно по запросу от бортового кода, в этом случае формирование сообщения происходит в момент запроса, а выдача раньше циклической выдачи статусных сообщений. Так же предусмотрена возможность установки заявки на однократное формирование статусного ТМ-сообщения, которое будет сформировано и выдано при формировании и выдаче циклической статусной информации, но с более высоким приоритетом, чем любые другие циклические ТМ-сообщения.
                <p>При формировании статусного ТМ-сообщения большой длины производится его выдача в виде сегментов. С момента формирования сообщения до его полной выдачи все данные хранятся внутри компонента ТМ. Важно отметить, что формирование сегментированного сообщения производится одномоментно и в полном объеме, за счет чего обеспечивается согласованность данных параметров ТМ-сообщения.
            </div>
            <hr/>

            <h4 id="arch-tm-event">Формирование событийной ТМ-информации</h4>
            <div>
                <p>Событийная ТМ-информация формируется по запросу от бортового кода и помещается в циклический буфер в соответствии с приоритетом ТМ-сообщения. Выдача сформированных сообщений производится в очередности определяемой приоритетом. Пока не будут выданы все сообщения более высокого приоритета выдача других сообщения не производится.
                <p>Компонент телеметрии предусматривает возможности ограничения формирования событийных сообщений: как всех сообщений определенного компонента, так и только определенного ТМ-сообщения компонента или определенного события событийного ТМ-сообщения.
                <p>При переполнении циклических буферов событийных сообщений происходит затирание старых сообщений новыми, при этом номер ТМ-сообщения и номер события отмечается в массиве утерянных сообщений. Когда производится выдача сообщения с перечнем утерянных событийных сообщений, то список очищается.
            </div>
        </div>
        <hr/>

        <h3 id="arch-script">Управление бортовыми скриптами (циклограммами)</h3>
        <div>
            <p>Компонент управления бортовыми скриптами позволяет управлять загрузкой, выгрузкой, исполнением и планированием запуска бортовых программ.
            <p>Бортовая программа представляет собой скомпилированный байт-код виртуальной бортовой машины, который исполняется в рамках работы бортовой вычислительной системы независимо от доступности НКУ и наличия связи с НКУ и другими аппаратами.
            <p>Компонент управления цкилограммами поддерживает возможность отложенного запуска скрипта, планирования запуска по времени, а так же периодический запуск скриптов.
            <p><a href="#decode">Полное описание команд и ТМ-сообщений компонента реализовано на языке Decode.</a>
        </div>

    </div>
    <hr/>

    <h2 id="segment">Использование сегментированной передачи</h2>
    <div>
        <p>Сегментированная передача данных используется для мултиплексирования передачи больших объемов данных в составе телеметрического потока с передачей других данных, таких как событийная
ТМ-информация.
        <p>При передаче сегментированных данных (в случае, когда максимальный номер сегмента не равен 0) данные считаются полученными в случае получения и успешной валидации всех сегментов данных.
        <p>Если источник и приемник поддерживают интерфейс досылки и гарантированной передачи сегментированных данных, то они могут контролировать отправку и получение отдельных сегментов:
        <ul>
            <li>Источник может предварительно отправить пакет с командой на включение режима гарантированной передачи сегментированного пакета. Тем самым он обязуется хранить все сегменты данных отправленных приемнику и пересылать их в случае утери и до получения команды от приемника уведомляющей о получении всех сегментов приемником.
            <li>В режиме гарантированной передачи сегментированных данных приемник должен формировать команды запрашивающие пересылку неполученных или некорректных сегментов в случае получения номера сегмента отличного от следующего ожидаемого.
            <li>После получения последнего сегмента с номером равным максимальному сегменту приемник должен периодически отсылать запрос на пересылку отсутствующих сегментов. При получении всех сегментов приемник должен оповестить источник командой о том, что сегментированная передача успешно завершена. После получения такого оповещения источник может освободить ресурсы занятые на хранение всех сегментов данных.
            <li>При необходимости источник с помощью команды так же может запросить подтверждение о получении каждого сегмента по мере их прохождения и валидации, в этом случае приемник должен формировать команды оповещения на получение каждого корректного сегмента, что позволит источнику освобождать ресурсы по мере подтвержденной пересылки сегментов.
            <li>После пересылки всех требуемых сегментов приемнику, источник через некоторое время должен периодически слать команду запрос о статусе работы режима гарантированной передачи сегментированных данных. При получениии ответа о том, что режим гарантированной передачи на приемнике не активен передача сегментированных данных считается завершенной. В случае отсутствия обратной связи от приемника в режиме гарантированной передачи формируется сообщение об ошибке с некоторой периодичностью до тех пор, пока режим не будет выключен вручную или приемник не ответит на запросы.
        </ul>
        <p><a href="#decode">Полное описание команд и ТМ-сообщений компонента реализовано на языке Decode.</a>
    </p></div>
    <hr>

    <h2 id="identification">Расширение для динамической идентификации устройств и их интерфейсов</h2>
    <div>
        <p>Для работы в сетях с разнородными устройствами и различными прошивками требуется динамическая идентификация устройств и интерфейсов реализуемых бортовым ПО (наборов компонент, а так же их ТМ- и командных сообщений). Для этого предусмотренно расширение протокола добавляющее возможность такую информацию запросить.
        <p>Для формирования команд и рабора ТМ-информации от компонента идентификации использется специальный номер компонента &mdash; 0. Команда отправленная в компонент с номером 0 всегда будет передана компоненту идентификации, а ТМ-информация от компонента с номером 0 всегда соответствует компоненту идентификации.
        <p><a href="#decode">Полное описание команд и ТМ-сообщений компонента реализовано на языке Decode.</a>
    </div>
    <hr/>

    <h2 id="files">Расширение для загрузки и выгрузки файлов</h2>
    <div>
        <p>Файловое расширение позвлояет производить загрузку и выгрузку файлов с аппарата, а так же управлять структурой
        каталогов.
        <p><a href="#decode">Полное описание команд и ТМ-сообщений компонента реализовано на языке Decode.</a>
    </div>
    <hr/>

    <h2 id="routing">Расширение для динамической маршрутизация пакетов</h3>
    <div>
        <p>Компонент динамической маршрутизации пакетов позволяет бортовой системе выстраивать и изменять таблицу маршрутизации пакетов во время работы по информации получаемой при обмене с другими устройствами в сети. Поддерживается таблица маршрутизации как по отдельным устройствам, так и по группам устройств.
        <p>Так же компонент позволяет управлять таблицей маршрутизации в ручную или посредством скриптов как с НКУ, так и с других устройств в сети.
        <p><a href="#decode">Полное описание команд и ТМ-сообщений компонента реализовано на языке Decode.</a>
    </div>
    <hr/>

    <h2 id="decode">Описание компонентов бортовой системы на языке Decode</h2>
    <div>
    <pre style="background-color: #2b2b2b"><span class="s0">namespace </span><span class="s1">ru.mipt.acsl

</span><span class="s2">&quot;Строка&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">string [u8]

</span><span class="s2">&quot;Пара номер компонента и его уникальный идентификатор&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">component_number_guid_pair
</span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">'Номер компонента в пределах устройства'</span><span class="s1">
  </span><span class="s0">ber  </span><span class="s1">number</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Уникальный идентификатор компонента'</span><span class="s1">
  guid guid</span><span class="s3">,</span><span class="s1">
)

</span><span class="s2">&quot;Идентификатор устройства и его корневого компонента&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">short_id
</span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">'Уникальный идентификатор устройства'</span><span class="s1">
  guid  deviceGuid</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Уникальный идентификатор компонента устройства'</span><span class="s1">
  guid  rootComponentGuid</span><span class="s3">,</span><span class="s1">
)

</span><span class="s2">&quot;Идентификатор устройства и всех его компонентов&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">full_id </span><span class="s0">struct</span><span class="s1">
(
    short_id shortId</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Идентификаторы всех компонентов устройства'</span><span class="s1">
    [component_number_guid_pair</span><span class="s3">, </span><span class="s4">1</span><span class="s1">..*] deviceComponentGuidPairs</span><span class="s3">,</span><span class="s1">
)

</span><span class="s2">'Компонент идентификации устройства и всех его компонентов'</span><span class="s1">
</span><span class="s0">component </span><span class="s1">Identification</span><span class="s0">:</span><span class="s4">0</span><span class="s1">
{
  </span><span class="s0">parameters</span><span class="s1">
  (
    full_id fullId</span><span class="s3">,</span><span class="s1">
  )

  </span><span class="s2">'Запросить идентификатор устройства и идентификатор компонента устройства'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">requestShortId() -&gt; short_id

  </span><span class="s2">'Запросить идентификатор устройства, компонента устройства и всех его подкомпонентов'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">requestFullId() -&gt; full_id

  </span><span class="s2">'Запросить идентификатор компонента по номеру'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">requestComponentGuid(</span><span class="s0">ber </span><span class="s1">componentNumber) -&gt; guid
}

</span><span class="s2">&quot;Ошибка начала режима сегментированной выдачи&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">segment_start_ack_error </span><span class="s0">enum ber </span><span class="s1">(ALREADY_STARTED = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">INVALID_STATE = </span><span class="s4">2</span><span class="s1">)

</span><span class="s2">&quot;Ошибка останова режима сегментированной выдачи&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">segment_stop_ack_error </span><span class="s0">enum ber </span><span class="s1">(NOT_STARTED = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">INVALID_STATE = </span><span class="s4">2</span><span class="s1">)

</span><span class="s2">&quot;Ошибка обработки получения сегмента&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">segment_process_ack_error </span><span class="s0">enum ber </span><span class="s1">(INVALID_STATE = </span><span class="s4">1</span><span class="s1">)

</span><span class="s2">&quot;Компонент режима сегментированной передачи ТМ-сообщения&quot;</span><span class="s1">
</span><span class="s0">component </span><span class="s1">Segment
{
  </span><span class="s0">parameters</span><span class="s1">
  (
    </span><span class="s2">'Режим гарантированной доставки активен'</span><span class="s1">
    b8  isSegmentationAckModeActive</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Максимальный номер сегмента'</span><span class="s1">
    </span><span class="s0">ber </span><span class="s1">maxSegmentNumber</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Режим подтверждения получения каждого сегмента активен'</span><span class="s1">
    b8  isAckOnEverySegmentModeActive</span><span class="s3">,</span><span class="s1">
  )

  </span><span class="s2">'Начать режим гарантированной передачи'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">startSegmentAckMode</span><span class="s0">:</span><span class="s4">0</span><span class="s1">() -&gt; segment_start_ack_errror?

  </span><span class="s2">'Отключить режим гарантированной передачи'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">stopSegmentAckMode</span><span class="s0">:</span><span class="s4">1</span><span class="s1">() -&gt; segment_stop_ack_error?

  </span><span class="s2">'Запросить статус режима гарантированной передачи'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">requestAckModeStatus</span><span class="s0">:</span><span class="s4">2</span><span class="s1">() -&gt; b8

  </span><span class="s2">'Обработать статус режима гарантированной передачи'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">processAckModeStatus</span><span class="s0">:</span><span class="s4">3</span><span class="s1">(b8 isSegmentationAckModeActive) -&gt; segment_process_ack_error?

  </span><span class="s2">'Включить режим подтверждения получения каждого сегмента'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">startAckOnEverySegmentMode</span><span class="s0">:</span><span class="s4">4</span><span class="s1">() -&gt; segment_start_ack_errror?

  </span><span class="s2">'Выключить режим подтверждения получения каждого сегмента'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">stopAckOnEverySegmentMode</span><span class="s0">:</span><span class="s4">5</span><span class="s1">() -&gt; segment_stop_ack_error?
}

</span><span class="s2">&quot;Компонент сервера поддерживающиего сегментированную передачу ТМ-сообщения&quot;</span><span class="s1">
</span><span class="s0">component </span><span class="s1">SegmentSender </span><span class="s0">with </span><span class="s1">Segment
{
  </span><span class="s2">'Обработать подтверждения о получении сегментов'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">processSegmentsAck</span><span class="s0">:</span><span class="s4">0</span><span class="s1">([</span><span class="s0">ber</span><span class="s3">, </span><span class="s4">1</span><span class="s1">..*] segmentsReceived) -&gt; segment_process_ack_error?
}

</span><span class="s2">&quot;Компонент клиента поддерживающего сегментированное получение ТМ-сообщения&quot;</span><span class="s1">
</span><span class="s0">component </span><span class="s1">SegmentReceiver </span><span class="s0">with </span><span class="s1">Segment
{
  </span><span class="s0">parameters</span><span class="s1">
  (
    </span><span class="s2">'Перечень полученных сегментов'</span><span class="s1">
    [</span><span class="s0">ber</span><span class="s1">] segmentsReceived</span><span class="s3">,</span><span class="s1">
  )

  </span><span class="s2">'Перечень полученных сегментов'</span><span class="s1">
  </span><span class="s0">status </span><span class="s1">segmentsReceived
  (
    segmentsReceived</span><span class="s3">,</span><span class="s1">
  )

  </span><span class="s2">'Запросить перечень полученных сегментов'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">requestSegmentsAck() -&gt; [</span><span class="s0">ber</span><span class="s1">]
}

</span><span class="s5">/* Tm */</span><span class="s1">

</span><span class="s2">'Циклический массив'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">ring_buf </span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">'Данные циклического массива'</span><span class="s1">
  [u8] data</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Смещение начала цкилического массива'</span><span class="s1">
  </span><span class="s0">ber </span><span class="s1">startOffset</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Смещение конца циклического массива'</span><span class="s1">
  </span><span class="s0">ber </span><span class="s1">endOffset</span><span class="s3">,</span><span class="s1">
)

</span><span class="s2">'Номер компонента и номер сообщения'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">comp_msg </span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">'Номер компонента'</span><span class="s1">
  </span><span class="s0">ber </span><span class="s1">componentNum</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Номер сообщения в компоненте'</span><span class="s1">
  </span><span class="s0">ber </span><span class="s1">messageNum</span><span class="s3">,</span><span class="s1">
)

</span><span class="s2">'Информация о событии'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">event_info </span><span class="s0">struct</span><span class="s1">
(
  comp_msg componentMessage</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Номер события'</span><span class="s1">
  </span><span class="s0">ber      </span><span class="s1">eventNum</span><span class="s3">,</span><span class="s1">
)

</span><span class="s0">type </span><span class="s1">tm_cmd_error </span><span class="s0">enum ber </span><span class="s1">(INVALID_ARGUMENT = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">INVALID_STATE = </span><span class="s4">2</span><span class="s1">)

</span><span class="s2">'Управление формированием и выдачей ТМ-информации'</span><span class="s1">
</span><span class="s0">component </span><span class="s1">Tm
{
  </span><span class="s0">parameters</span><span class="s1">
  (
    </span><span class="s2">'Заявки на однократную выдачу событийных ТМ-сообщений'</span><span class="s1">
    [u8]         onceRequests</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Запреты на формирование и выдачу сообщений'</span><span class="s1">
    [[u8]]       deniedMessagesByComponent</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Заявки на выдачу событийных ТМ-сообщений в соответствии с частотой выдачи'</span><span class="s1">
    [[u8]]       priorityOrderedRequests</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Массив внеочередной выдачи ТМ-сообщений'</span><span class="s1">
    ring_buf     outOfOrderMesages</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Массив утерянных событий'</span><span class="s1">
    [event_info] lostEvents</span><span class="s3">,</span><span class="s1">
  )

  </span><span class="s2">'Выдать событийное ТМ-сообщение'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">sendEventMessage(</span><span class="s2">'Информация о событии' </span><span class="s1">event_info eventInfo) -&gt; tm_cmd_error?

  </span><span class="s2">'Выдать статусное сообщение во внеочередную выдачу'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">sendStatusMessage(comp_msg componentMessage) -&gt; tm_cmd_error?

  </span><span class="s2">'Установить запрос на выдачу в соответствии с приоритетом'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">setMessageRequest(comp_msg componentMessage</span><span class="s3">, </span><span class="s2">'Приоритет' </span><span class="s0">ber </span><span class="s1">priority) -&gt; tm_cmd_error?

  </span><span class="s2">'Снять запрос на выдачу в соответствии с приоритетом'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">clearMessageRequest(comp_msg componentMessage</span><span class="s3">, </span><span class="s2">'Приоритет' </span><span class="s0">ber </span><span class="s1">priority) -&gt; tm_cmd_error?

  </span><span class="s2">'Запретить формирование ТМ-сообщения'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">denyMessage(comp_msg componentMessage) -&gt; tm_cmd_error?

  </span><span class="s2">'Снять запрет на формирование ТМ-сообщения'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">allowMessage(comp_msg componentMessage) -&gt; tm_cmd_error?

  </span><span class="s2">'Установить запрет на формирование и выдачу события'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">denyEvent(event_info eventInfo) -&gt; tm_cmd_error?

  </span><span class="s2">'Снять запрет на формирование и выдачу события'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">allowEvent(event_info eventInfo) -&gt; tm_cmd_error?
}

</span><span class="s5">/* Scripts */</span><span class="s1">

</span><span class="s2">'Идентификатор скрипта'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">script_id guid

</span><span class="s2">'Информация о скрипте'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">script_info </span><span class="s0">struct</span><span class="s1">
(
  script_id scriptId</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Данные скрипта'</span><span class="s1">
  [u8]      scriptData</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Байткод скрипта'</span><span class="s1">
  [u8]      scriptCode</span><span class="s3">,</span><span class="s1">
)

</span><span class="s2">'Дата и время'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">date_time </span><span class="s0">ber</span><span class="s1">
</span><span class="s2">'Период времени'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">period    </span><span class="s0">ber</span><span class="s1">

</span><span class="s2">'Запланированный запуск скрипта'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">script_run_timing </span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">'Идентификатор запланированного запуска'</span><span class="s1">
  guid        id</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Запуск запланирован'</span><span class="s1">
  b8          isActive</span><span class="s3">,</span><span class="s1">
  script_id   scriptId</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Время запуска'</span><span class="s1">
  date_time   runOn</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Периодический скрипт'</span><span class="s1">
  b8          isRepeated</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Период повторения'</span><span class="s1">
  period /s/  repeatPeriod</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Повторение ограничено'</span><span class="s1">
  b8          isRepeatingLimitedByDate</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Дата и время окончания повторения запусков скрипта'</span><span class="s1">
  date_time   repeatUntil</span><span class="s3">,</span><span class="s1">
)

</span><span class="s0">type </span><span class="s1">scripting_error </span><span class="s0">enum ber </span><span class="s1">(INVALID_ARGUMENT = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">INVALID_STATE = </span><span class="s4">2</span><span class="s1">)

</span><span class="s2">'Управление бортовыми скриптами (циклограммами)'</span><span class="s1">
</span><span class="s0">component </span><span class="s1">Scripting
{
  </span><span class="s0">parameters</span><span class="s1">
  (
    </span><span class="s2">'Идентификаторы бортовых скриптов'</span><span class="s1">
    [guid]              scriptsIds</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Бортовые скрипты'</span><span class="s1">
    [script_info]       scripts</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">'Данные планировщика запуска скриптов'</span><span class="s1">
    [script_run_timing] scriptsRunTimings</span><span class="s3">,</span><span class="s1">
  )

  </span><span class="s2">'Загрузить скрипт'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">uploadScript
  (
    script_id scriptId</span><span class="s3">,</span><span class="s1">
    [u8]      scriptData</span><span class="s3">,</span><span class="s1">
    [u8]      scriptCode</span><span class="s3">,</span><span class="s1">
  ) -&gt; scripting_error?

  </span><span class="s2">'Удалить скрипт'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">deleteScript(script_id scriptId) -&gt; scripting_error?

  </span><span class="s2">'Запустить скрипт незамедлительно'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">runScriptNow(script_id scriptId) -&gt; scripting_error?

  </span><span class="s2">'Запланировать запуск скрипта'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">scheduleScriptRun(script_run_timing scriptRunTiming) -&gt; scripting_error?

  </span><span class="s2">'Активировать запланированный запуск скрипта'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">enableScriptRunTiming(guid scriptRunTimingId) -&gt; scripting_error?

  </span><span class="s2">'Деактивировать запланированный запуск скрипта'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">disableScriptRunTiming(guid scriptRunTimingId) -&gt; scripting_error?

  </span><span class="s2">'Перечень загруженных скриптов'</span><span class="s1">
  </span><span class="s0">status </span><span class="s1">availableScriptsIds
  (
    scriptsIds</span><span class="s3">,</span><span class="s1">
  )

  </span><span class="s2">'Данные планировщика запуска скриптов'</span><span class="s1">
  </span><span class="s0">status </span><span class="s1">scriptsRunTimings
  (
    scriptsRunTimings</span><span class="s3">,</span><span class="s1">
  )
}

</span><span class="s5">/* Files */</span><span class="s1">
</span><span class="s2">'Информация о файле'</span><span class="s1">
</span><span class="s0">type </span><span class="s1">full_file_info </span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">'Путь до файла'</span><span class="s1">
  string filePath</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Аттрибуты файла'</span><span class="s1">
  </span><span class="s0">ber    </span><span class="s1">fileAttrs</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Данные файла'</span><span class="s1">
  [u8]   fileContents</span><span class="s3">,</span><span class="s1">
)

</span><span class="s0">type </span><span class="s1">node_info </span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">'Имя узла в пределах каталога'</span><span class="s1">
  string name</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Флаг каталога'</span><span class="s1">
  b8     isDir</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">'Аттрибуты узла'</span><span class="s1">
  </span><span class="s0">ber    </span><span class="s1">attrs</span><span class="s3">,</span><span class="s1">
)

</span><span class="s0">type </span><span class="s1">file_upload_error </span><span class="s0">enum ber </span><span class="s1">(ALREADY_EXISTS = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">CANT_WRITE = </span><span class="s4">2</span><span class="s1">)
</span><span class="s0">type </span><span class="s1">file_delete_error </span><span class="s0">enum ber </span><span class="s1">(NOT_FOUND = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">CANT_DELETE = </span><span class="s4">2</span><span class="s1">)
</span><span class="s0">type </span><span class="s1">file_download_error </span><span class="s0">enum ber </span><span class="s1">(NOT_FOUND = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">CANT_READ = </span><span class="s4">2</span><span class="s3">, </span><span class="s1">NOT_FILE = </span><span class="s4">3</span><span class="s1">)
</span><span class="s0">type </span><span class="s1">file_list_error </span><span class="s0">enum ber </span><span class="s1">(NOT_FOUND = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">CANT_READ = </span><span class="s4">2</span><span class="s3">, </span><span class="s1">NOT_DIR = </span><span class="s4">3</span><span class="s1">)
</span><span class="s0">type </span><span class="s1">file_create_dir_error </span><span class="s0">enum ber </span><span class="s1">(NOT_FOUND = </span><span class="s4">1</span><span class="s3">, </span><span class="s1">CANT_WRITE = </span><span class="s4">2</span><span class="s1">)

</span><span class="s2">&quot;Компонент поддерживающий управление файловой системой&quot;</span><span class="s1">
</span><span class="s0">component </span><span class="s1">Files
{
  </span><span class="s2">'Загрузить файл'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">uploadFile(</span><span class="s2">'Информация о загружаемом файле' </span><span class="s1">full_file_info fileInfo) -&gt; file_upload_error?

  </span><span class="s2">'Скачать файл'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">downloadFile(</span><span class="s2">'Путь до файла' </span><span class="s1">string path) -&gt; or&lt;full_file_info</span><span class="s3">, </span><span class="s1">file_download_error&gt;

  </span><span class="s2">'Удалить файл или каталог'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">deleteNode(</span><span class="s2">'Путь до узла' </span><span class="s1">string path) -&gt; file_delete_error?

  </span><span class="s2">'Запросить перечень файлов в каталоге'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">requestFileList(</span><span class="s2">'Путь до каталога' </span><span class="s1">string path) -&gt; or&lt;[node_info]</span><span class="s3">, </span><span class="s1">file_list_error&gt;

  </span><span class="s2">'Запросить создание каталога'</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">createDir(</span><span class="s2">'Путь к каталогу' </span><span class="s1">string path) -&gt; file_create_dir_error?
}

</span><span class="s2">&quot;Адрес абонента&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">address </span><span class="s0">ber</span><span class="s1">

</span><span class="s2">&quot;Запись таблицы маршрутизации&quot;</span><span class="s1">
</span><span class="s0">type </span><span class="s1">route </span><span class="s0">struct</span><span class="s1">
(
  </span><span class="s2">&quot;Адрес назначения&quot;</span><span class="s1">
  address destination_address</span><span class="s3">,</span><span class="s1">
  </span><span class="s2">&quot;Следующий узел в пути&quot;</span><span class="s1">
  address next_hop</span><span class="s3">,</span><span class="s1">
)

</span><span class="s5">/* Router, dynamic routing table */</span><span class="s1">

</span><span class="s2">&quot;Компонент реализующий возможность динамической маршрутизации и управления таблицей маршрутизации с НКУ&quot;</span><span class="s1">
</span><span class="s0">component </span><span class="s1">Router
{
  </span><span class="s0">parameters</span><span class="s1">
  (
    </span><span class="s2">&quot;Таблица маршрутизации по устройствам&quot;</span><span class="s1">
    [route] routes</span><span class="s3">,</span><span class="s1">
    </span><span class="s2">&quot;Таблица маршрутизации по группам&quot;</span><span class="s1">
    [route] groupRoutes</span><span class="s3">,</span><span class="s1">
  )

  </span><span class="s2">&quot;Установить правило маршрутизации для абонента&quot;</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">setRoute(</span><span class="s2">&quot;Адрес абонента&quot; </span><span class="s1">address address</span><span class="s3">, </span><span class="s2">&quot;Следующий узел в пути&quot; </span><span class="s1">address next_hop)

  </span><span class="s2">&quot;Удалить все правила для абонента&quot;</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">delRoute(</span><span class="s2">&quot;Адрес абонента&quot; </span><span class="s1">address address)

  </span><span class="s2">&quot;Установить правило маршрутизации для абонента&quot;</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">setGroupRoute(</span><span class="s2">&quot;Адрес группы&quot; </span><span class="s1">address groupAddress</span><span class="s3">, </span><span class="s2">&quot;Следующий узел в пути&quot; </span><span class="s1">address next_hop)

  </span><span class="s2">&quot;Удалить все правила для группы&quot;</span><span class="s1">
  </span><span class="s0">command </span><span class="s1">delGroupRoute(</span><span class="s2">&quot;Адрес группы&quot; </span><span class="s1">address groupAddress)
}</span></pre>
    </div>
    <hr/>

    © 2015 <a href="http://acsl.mipt.ru/">ЛПСУ</a>
</div>

</body>
</html>
